:imagesdir: Images

[.text-center]
МИНИСТЕРСТВО НАУКИ И ВЫСШЕГО ОБРАЗОВАНИЯ РОССИЙСКОЙ ФЕДЕРАЦИИ +
Федеральное государственное автономное образовательное учреждение
высшего образования +
«Южно-Уральский государственный университет» +
(национальный исследовательский университет) +
Высшая школа электроники и компьютерных наук +
Кафедра «Информационно-измерительная техника»

[.text-center]
Отчет по лабораторной работе №2

[.text-right]
Выполнил: +
студент группы КЭ-415 +
Тимиргазин И.М.



== Задание
--
. Написать программу вычисляющую следующее выражение *-3/3U *3* и объяснить результат.
. Подключить плату к домашнему компьютеру, проверить что все работает, плата прошивается.
. Запустить на плате проект *Lab1* и добавить в *main* код для зажигания светодиодов, представленный ниже:

[source, c]
----
#include "gpioaregisters.hpp" //for Gpioa
#include "rccregisters.hpp" //for RCC

int main()
{

RCC::AHB1ENR::GPIOCEN::Enable::Set() ;
GPIOC::MODER::MODER5::Output::Set() ;
GPIOC::ODR::ODR5::Enable::Set() ;
GPIOC::ODR::ODR5::Disable::Set() ;
return 0 ;
}
----
Не забыть подключить
----
 #include "gpioaregisters.hpp" //for Gpioa
----
Пронаблюдать происходящее на плате и зафиксировать в виде фотографии.
--

=== 1. Код программы

Напишем код программы вычисляющий выражение *-3/3U *3* (рисунок 1).

. Код программы

.- Код программы
image::image-2021-09-30-15-21-17-142.png[align = "center"]

Результат программы в окне Terminal I/O (рисунок 2).

.- Результат программы в окне Terminal I/O
image::image-2021-09-30-17-29-20-400.png[align = "center"]

Если убрать приведение к типу intв примере выше, то получим 4294967292 или 0xFFFFFFFС(-4). Получается, что компилятор на самом деле считает результат беззнаковым и равным 4294967292. До этого момента я был свято уверен, что если в выражении используется знаковый тип, то и результат будет знаковым. Логично же это. Получается, что для деления беззнакового числа на знаковое используется БЕЗЗНАКОВАЯ операция деления
Проблема еще и в том, что число 4294967293 не делится на 3 без остатка: 4294967293 = 1431655764 * 3 + 1 и при умножении 1431655764 обратно на 3, получаем 4294967292 или -4. Так что прикинуться веником и считать, что 4294967293 это то же -3, только вид сбоку, для операции деления не прокатит.
Иначе, если ранг преобразования беззнакового операнда больше или равен рангу преобразования знакового операнда, то знаковый операнд приводится к типу беззнакового операнда.

=== 2. Подключение платы
Подключение платы к компьютеру осуществляется через USB разъем.
На рисунке 3 изображена плата, подключенная через USB разъём к компьютеру, о чем говорит красное свечение индикатора.

[.center.text-center]
.- Подключенная плата

image::image-2021-09-30-17-40-01-157.png[align = "center"]

=== 3. Работа с платой

Создадим пустой проект, установим настройки как и в предыдущей лабораторной работе (рисунок 4).

[.center.text-center]
.- Новый проект
image::image-2021-09-30-18-00-07-138.png[align = "center"]

В настройках проекта выберем плату _ST STM32F411RE_. Чтобы не возникало ошибки как на рисунке 5.

.- Возникновение ошибки при сборке проекта
image::image-2021-09-30-18-05-10-857.png[]

Для исправления данной ошибки необходимо зайти в опции проекта => пункт _C/C++ Compiler_ => в категории _List_ и убрать галочку со строки _Output assembler file_, как показано на рисунке 6.

.- Пункт _C/C++ Compiler_ категория _List_
image::image-2021-09-30-18-10-33-480.png[]

Далее нужно заново запустить проект и проверить на наличие ошибок.

.- Прошивка платы
image::image-2021-09-30-18-15-15-806.png[width=205,height=90, float="right",align="center"]

Индикатор, который ранее горел красным, стал гореть зелёным, соответственно можно сказать, что плата прошита.
Прошивка платы показана на рисунке 7.

=== 4. Активация светодиода
Для начала следует запустить проект _Lab1_, в котором находятся необходимые файлы для работы с платой.
Запускаем проект:

* Project => Add Existing Project (рисунок 8);=90, float="left", align="cen

.- Пункт меню проект
image::image-2021-09-30-18-20-14-487.png[]


Проделаем все те же операции что и в предыдущем пункте, откроем наш проект, выберем плату в данном случае _ST STM32F411RE_, зайдем в категорию _C/C++ Compiler_ и также уберем галочки, где это необходимо.

В категории _Debugger_ нужно выбрать пункт _Driver_ и выставить параметр _ST-LINK_ вместо _Simulation_, инструкция продемострирована на рисунке 9.

[.right.text-center]
.- Выбор параметра _ST-LINK_
image::image-2021-09-30-18-36-18-942.png[]

Данная манипуляция предназначена для того, чтобы мы могли работать с самой платой, а не с ее симуляцией в программе.

Последним этапом для включения светодиода является код из задания, нам необходимо записать его к себе в программу, а то есть в функцию _main_.

Код представлен ниже


[source, c]
----
#include "rccregisters.hpp" // for RCC
#include "gpioaregisters.hpp" //for Gpioa

std::uint32_t SystemCoreClock = 16'000'000U;

extern "C" {
int __low_level_init(void)
{
  //Switch on external 16 MHz oscillator
  RCC::CR::HSION::On::Set();
  while (RCC::CR::HSIRDY::NotReady::IsSet())
  {

  }
  //Switch system clock on external oscillator
  RCC::CFGR::SW::Hsi::Set();
  while (!RCC::CFGR::SWS::Hsi::IsSet())
  {

  }

  RCC::APB2ENR::SYSCFGEN::Enable::Set();

  return 1;
}
}


int main()
{
  RCC::AHB1ENR::GPIOAEN::Enable::Set();
  GPIOA::MODER::MODER5::Output::Set();
  GPIOA::ODR::ODR5::High::Set();

  return 0;
}
----

Для проверки запустим программу и посмотрим на правильность выполнения работы.

Результат проделанной работы представлен на рисунке 10.

[.align.text-center]
.- Плата с горящим светодиодом
image::image-2021-09-30-19-02-00-681.png[A,240,180,]

Светодиод загорелся, слдеовательно, можно сказать, что программа работает так как изадумывалось.




